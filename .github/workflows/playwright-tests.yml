name: Playwright Tests
on:
  workflow_call:
  workflow_dispatch:

env:
  FORCE_COLOR: "1" # Make tools pretty.
  PIP_DISABLE_PIP_VERSION_CHECK: "1"

jobs:
  playwright:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: "3.14"
          cache: "pip"
      - uses: actions/setup-node@v5
        with:
          node-version-file: ".nvmrc"
      - uses: gerlero/apt-install@a0d81074b838120197865dc2576f67c4f40044b2
        name: Install gettext
        with:
          packages: gettext
      - name: Install frontend dependencies
        run: |
          yarn install --frozen-lockfile
      - name: Compile JavaScript
        run: |
          yarn build
      - name: Install backend dependencies
        run: |
          python -m pip install .[testing,playwright]
      - name: Compile translations
        run: /bin/sh ./scripts/compile_translations.sh
      - name: Run E2E tests
        run: |
          /bin/sh ./scripts/run_e2e_testsuite.sh
      - name: Upload Playwright traces
        uses: actions/upload-artifact@v4
        if: ${{ !cancelled() }}
        with:
          name: playwright-traces
          path: test-results/
          retention-days: 3
